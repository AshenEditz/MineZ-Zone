<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MineZ Zone - Test Console</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a0000 50%, #001a1a 100%);
            color: #00ffff;
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #00ffff;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
        }

        .header h1 {
            color: #00ffff;
            text-shadow: 0 0 15px #00ffff;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .status {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 15px;
            font-size: 16px;
        }

        .status.loading {
            background: #ffa500;
            color: #000;
            animation: pulse 1.5s infinite;
        }

        .status.success {
            background: #00ff00;
            color: #000;
        }

        .status.error {
            background: #ff0000;
            color: #fff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }

        .panel {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #00ffff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .panel h2 {
            color: #ff0000;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #00ffff;
            padding-bottom: 10px;
            text-align: center;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            border: 3px solid #00ffff;
            background: transparent;
            color: #00ffff;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
            font-size: 16px;
            transition: all 0.3s;
            text-align: center;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 0 25px #00ffff;
        }

        .btn.success {
            border-color: #00ff00;
            color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }

        .btn.success:active {
            background: #00ff00;
            color: #000;
        }

        .btn.danger {
            border-color: #ff0000;
            color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
        }

        .btn.danger:active {
            background: #ff0000;
            color: #fff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: rgba(0, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #00ffff;
            text-align: center;
        }

        .stat-card h4 {
            color: #00ffff;
            margin-bottom: 8px;
            font-size: 12px;
            text-transform: uppercase;
        }

        .stat-card .number {
            font-size: 28px;
            font-weight: bold;
            color: #ff0000;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #00ffff;
            border-radius: 20px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #00ff00, #ff0000);
            width: 0%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 16px;
        }

        .test-result {
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 255, 255, 0.1);
            border-left: 5px solid #666;
            border-radius: 8px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .test-result.success {
            border-left-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }

        .test-result.error {
            border-left-color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
        }

        .test-result.warning {
            border-left-color: #ffa500;
            background: rgba(255, 165, 0, 0.1);
        }

        .test-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .test-message {
            font-size: 14px;
            opacity: 0.9;
            margin-left: 30px;
        }

        .icon {
            font-size: 20px;
        }

        .debug-console {
            background: #000;
            border: 3px solid #00ffff;
            border-radius: 12px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .console-line {
            padding: 8px 5px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
            word-wrap: break-word;
        }

        .console-line.info { color: #00ffff; }
        .console-line.success { color: #00ff00; }
        .console-line.error { color: #ff0000; }
        .console-line.warning { color: #ffa500; }

        .alert {
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            border-left: 5px solid;
            font-size: 14px;
        }

        .alert.info {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            color: #00ffff;
        }

        .alert.success {
            background: rgba(0, 255, 0, 0.2);
            border-color: #00ff00;
            color: #00ff00;
        }

        .alert.error {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
            color: #ff0000;
        }

        .alert.warning {
            background: rgba(255, 165, 0, 0.2);
            border-color: #ffa500;
            color: #ffa500;
        }

        .env-info {
            background: rgba(0, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #00ffff;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }

        .env-info p {
            margin: 5px 0;
        }

        .env-info strong {
            color: #ff0000;
        }

        .form-group {
            margin: 15px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #00ffff;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group input[type="file"] {
            display: block;
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #00ffff;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
        }

        .json-viewer {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #00ffff;
            overflow-x: auto;
            margin: 10px 0;
            max-height: 250px;
            overflow-y: auto;
        }

        .json-viewer pre {
            margin: 0;
            color: #00ff00;
            font-size: 11px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }

        .badge.prod {
            background: #00ff00;
            color: #000;
        }

        .badge.dev {
            background: #ffa500;
            color: #000;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #00ffff;
            border-radius: 4px;
        }

        .big-emoji {
            font-size: 40px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéÆ MineZ Zone</h1>
            <p>Vercel Backend Test Console</p>
            <div class="status loading" id="systemStatus">Initializing...</div>
        </div>

        <!-- Environment Info -->
        <div class="panel">
            <h2>üåê Environment</h2>
            <div class="env-info">
                <p><strong>URL:</strong> <span id="currentUrl">-</span></p>
                <p><strong>Host:</strong> <span id="hostname">-</span> <span id="envBadge"></span></p>
                <p><strong>API:</strong> <span id="apiEndpoint">-</span></p>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <h4>Total</h4>
                <div class="number" id="testsRun">0</div>
            </div>
            <div class="stat-card">
                <h4>Passed</h4>
                <div class="number" id="testsPassed" style="color: #00ff00;">0</div>
            </div>
            <div class="stat-card">
                <h4>Failed</h4>
                <div class="number" id="testsFailed" style="color: #ff0000;">0</div>
            </div>
            <div class="stat-card">
                <h4>Uploads</h4>
                <div class="number" id="uploadsCount" style="color: #ffa500;">0</div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar">0%</div>
        </div>

        <!-- Quick Test Button -->
        <button class="btn success" onclick="runAllTests()" style="font-size: 18px;">
            ‚ñ∂Ô∏è RUN ALL TESTS
        </button>

        <!-- Test Results -->
        <div class="panel">
            <h2>üìã Test Results</h2>
            <div id="testResults">
                <div class="alert info">üëÜ Tap "RUN ALL TESTS" button above to start!</div>
            </div>
        </div>

        <!-- Individual Tests -->
        <div class="panel">
            <h2>üîß Individual Tests</h2>
            <button class="btn" onclick="testFirebase()">üî• Test Firebase</button>
            <button class="btn" onclick="testVercelAPI()">‚ö° Test Vercel API</button>
            <button class="btn" onclick="testGitHubConnection()">üì¶ Test GitHub</button>
            <button class="btn" onclick="testFileUpload()">üì§ Test Upload</button>
        </div>

        <!-- File Upload Test -->
        <div class="panel">
            <h2>üì§ Upload Test</h2>
            <div class="form-group">
                <label>üì∏ Select Image:</label>
                <input type="file" id="testImageFile" accept="image/*">
            </div>
            <div class="form-group">
                <label>üìÅ Select File (Optional):</label>
                <input type="file" id="testContentFile">
            </div>
            <button class="btn success" onclick="testActualUpload()">
                üöÄ UPLOAD FILES
            </button>
            <div id="uploadResult"></div>
        </div>

        <!-- API Response -->
        <div class="panel">
            <h2>üì° API Response</h2>
            <div id="apiResponse">
                <div class="alert info">No API calls yet...</div>
            </div>
        </div>

        <!-- Debug Console -->
        <div class="panel">
            <h2>üñ•Ô∏è Console Logs</h2>
            <button class="btn danger" onclick="clearDebugConsole()" style="margin-bottom: 10px;">
                üóëÔ∏è Clear Console
            </button>
            <div class="debug-console" id="debugConsole">
                <div class="console-line info">[INFO] Console ready...</div>
            </div>
        </div>

        <!-- Footer Info -->
        <div style="text-align: center; padding: 20px; opacity: 0.7; font-size: 12px;">
            <p>MineZ Zone Test Console v2.0</p>
            <p>Optimized for Mobile üì±</p>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBZacr9I_ecEUKU1ZV3EsjcfGIHkfnVQdQ",
            authDomain: "minez-zone.firebaseapp.com",
            databaseURL: "https://minez-zone-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "minez-zone",
            storageBucket: "minez-zone.firebasestorage.app",
            messagingSenderId: "840393320273",
            appId: "1:840393320273:web:b1d128705055a65b781570"
        };

        // Detect Environment
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const API_URL = isLocal ? 'http://localhost:3000/api' : '/api';

        // Test Statistics
        let stats = {
            total: 0,
            passed: 0,
            failed: 0,
            uploads: 0
        };

        // Initialize Firebase
        let app, auth, database;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            database = firebase.database();
            log('‚úÖ Firebase initialized', 'success');
            updateSystemStatus('success', 'Ready ‚úÖ');
        } catch (error) {
            log('‚ùå Firebase init failed: ' + error.message, 'error');
            updateSystemStatus('error', 'Error ‚ùå');
        }

        // Initialize on Load
        window.addEventListener('load', function() {
            updateEnvironmentInfo();
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('üéÆ MineZ Zone Test Console', 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('Environment: ' + (isLocal ? 'LOCAL' : 'PRODUCTION'), 'info');
            log('API: ' + API_URL, 'info');
            log('Ready! Tap RUN ALL TESTS üëÜ', 'success');
        });

        // Update Environment Info
        function updateEnvironmentInfo() {
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('hostname').textContent = window.location.hostname;
            document.getElementById('apiEndpoint').textContent = API_URL + '/upload';
            
            const badge = document.getElementById('envBadge');
            if (isLocal) {
                badge.innerHTML = '<span class="badge dev">DEV</span>';
            } else {
                badge.innerHTML = '<span class="badge prod">PROD</span>';
            }
        }

        // Console Logger
        function log(message, type = 'info') {
            const debugConsole = document.getElementById('debugConsole');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            const time = new Date().toLocaleTimeString();
            line.textContent = `[${time}] ${message}`;
            debugConsole.appendChild(line);
            debugConsole.scrollTop = debugConsole.scrollHeight;
            
            console[type === 'error' ? 'error' : 'log'](message);
        }

        function clearDebugConsole() {
            document.getElementById('debugConsole').innerHTML = '';
            log('Console cleared', 'info');
        }

        // Update System Status
        function updateSystemStatus(status, text) {
            const statusEl = document.getElementById('systemStatus');
            statusEl.className = `status ${status}`;
            statusEl.textContent = text;
        }

        // Update Statistics
        function updateStats() {
            document.getElementById('testsRun').textContent = stats.total;
            document.getElementById('testsPassed').textContent = stats.passed;
            document.getElementById('testsFailed').textContent = stats.failed;
            document.getElementById('uploadsCount').textContent = stats.uploads;

            const percentage = stats.total > 0 ? (stats.passed / stats.total * 100).toFixed(0) : 0;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';
        }

        // Add Test Result
        function addTestResult(name, status, message, data = null) {
            stats.total++;
            if (status === 'success') stats.passed++;
            else if (status === 'error') stats.failed++;
            
            updateStats();

            const resultsContainer = document.getElementById('testResults');
            
            if (resultsContainer.querySelector('.alert')) {
                resultsContainer.innerHTML = '';
            }

            const testDiv = document.createElement('div');
            testDiv.className = `test-result ${status}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è'
            };

            testDiv.innerHTML = `
                <div class="test-title">
                    <span class="icon">${icons[status]}</span>
                    <span>${name}</span>
                </div>
                <div class="test-message">${message}</div>
            `;

            resultsContainer.appendChild(testDiv);

            if (data) {
                const dataView = document.createElement('div');
                dataView.className = 'json-viewer';
                dataView.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                resultsContainer.appendChild(dataView);
            }

            // Scroll to result
            testDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Display API Response
        function displayAPIResponse(response, success = true) {
            const responseContainer = document.getElementById('apiResponse');
            responseContainer.innerHTML = `
                <div class="alert ${success ? 'success' : 'error'}">
                    ${success ? '‚úÖ API Response' : '‚ùå API Error'}
                </div>
                <div class="json-viewer">
                    <pre>${JSON.stringify(response, null, 2)}</pre>
                </div>
            `;
        }

        // Run All Tests
        async function runAllTests() {
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('Starting all tests...', 'info');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            document.getElementById('testResults').innerHTML = '';
            stats = { total: 0, passed: 0, failed: 0, uploads: 0 };
            updateStats();
            updateSystemStatus('loading', 'Testing... ‚è≥');

            await testFirebase();
            await sleep(500);
            await testVercelAPI();
            await sleep(500);
            await testGitHubConnection();

            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log(`Tests complete! ${stats.passed}/${stats.total} passed`, stats.failed > 0 ? 'warning' : 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            if (stats.failed === 0) {
                updateSystemStatus('success', 'All Passed ‚úÖ');
                showBigResult('success');
            } else {
                updateSystemStatus('error', `${stats.failed} Failed ‚ùå`);
                showBigResult('error');
            }
        }

        // Show Big Result
        function showBigResult(status) {
            const resultsContainer = document.getElementById('testResults');
            const emoji = status === 'success' ? 'üéâ' : '‚ö†Ô∏è';
            const message = status === 'success' 
                ? 'ALL TESTS PASSED!' 
                : 'SOME TESTS FAILED!';
            
            const bigDiv = document.createElement('div');
            bigDiv.className = 'big-emoji';
            bigDiv.textContent = emoji;
            resultsContainer.insertBefore(bigDiv, resultsContainer.firstChild);
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${status}`;
            alertDiv.style.fontSize = '18px';
            alertDiv.style.fontWeight = 'bold';
            alertDiv.style.textAlign = 'center';
            alertDiv.textContent = message;
            resultsContainer.insertBefore(alertDiv, resultsContainer.children[1]);
        }

        // Test Firebase
        async function testFirebase() {
            log('Testing Firebase...', 'info');

            try {
                if (app && auth && database) {
                    addTestResult('Firebase', 'success', 'All services initialized');
                    log('‚úÖ Firebase OK', 'success');
                    
                    const connectedRef = database.ref('.info/connected');
                    const snapshot = await connectedRef.once('value');
                    const connected = snapshot.val();
                    
                    if (connected) {
                        addTestResult('Database', 'success', 'Connected to Firebase Database');
                        log('‚úÖ Database connected', 'success');
                    } else {
                        addTestResult('Database', 'warning', 'Database not connected');
                        log('‚ö†Ô∏è Database offline', 'warning');
                    }
                } else {
                    throw new Error('Firebase not initialized');
                }
            } catch (error) {
                addTestResult('Firebase', 'error', error.message);
                log('‚ùå Firebase failed: ' + error.message, 'error');
            }
        }

        // Test Vercel API
        async function testVercelAPI() {
            log('Testing Vercel API...', 'info');

            try {
                const testData = {
                    content: btoa('Test file content'),
                    path: 'test/api-test.txt',
                    message: 'API test from mobile',
                    username: 'TestUser'
                };

                log('üì° Calling: ' + API_URL + '/upload', 'info');

                const response = await fetch(`${API_URL}/upload`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    addTestResult('Vercel API', 'success', 'Backend is working!', {
                        status: response.status,
                        url: data.url
                    });
                    log('‚úÖ Vercel API OK', 'success');
                    displayAPIResponse(data, true);
                } else {
                    throw new Error(data.error || 'API failed');
                }

            } catch (error) {
                addTestResult('Vercel API', 'error', error.message);
                log('‚ùå Vercel API failed: ' + error.message, 'error');
                displayAPIResponse({ error: error.message }, false);
            }
        }

        // Test GitHub
        async function testGitHubConnection() {
            log('Testing GitHub...', 'info');

            try {
                const response = await fetch('https://api.github.com/repos/asheneditz/minez-zone-storage');
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult('GitHub', 'success', 'Repository accessible', {
                        repo: data.full_name,
                        size: data.size + ' KB'
                    });
                    log('‚úÖ GitHub OK', 'success');
                } else {
                    throw new Error('Repository not accessible');
                }
            } catch (error) {
                addTestResult('GitHub', 'error', error.message);
                log('‚ùå GitHub failed: ' + error.message, 'error');
            }
        }

        // Test File Upload
        async function testFileUpload() {
            log('Testing file upload...', 'info');

            try {
                const testContent = 'Test file from mobile console';
                const blob = new Blob([testContent], { type: 'text/plain' });
                
                const reader = new FileReader();
                reader.readAsArrayBuffer(blob);
                
                reader.onload = async () => {
                    try {
                        const content = btoa(
                            new Uint8Array(reader.result)
                                .reduce((data, byte) => data + String.fromCharCode(byte), '')
                        );
                        
                        const testData = {
                            content: content,
                            path: `test/mobile-test-${Date.now()}.txt`,
                            message: 'Mobile upload test',
                            username: 'MobileTest'
                        };

                        log('üì§ Uploading test file...', 'info');

                        const response = await fetch(`${API_URL}/upload`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(testData)
                        });

                        const data = await response.json();

                        if (data.success) {
                            addTestResult('File Upload', 'success', 'Upload successful!', {
                                url: data.url
                            });
                            log('‚úÖ Upload OK', 'success');
                            stats.uploads++;
                            updateStats();
                        } else {
                            throw new Error(data.error || 'Upload failed');
                        }

                    } catch (error) {
                        addTestResult('File Upload', 'error', error.message);
                        log('‚ùå Upload failed: ' + error.message, 'error');
                    }
                };

            } catch (error) {
                addTestResult('File Upload', 'error', error.message);
                log('‚ùå Upload test failed: ' + error.message, 'error');
            }
        }

        // Test Actual Upload
        async function testActualUpload() {
            const imageFile = document.getElementById('testImageFile').files[0];
            const contentFile = document.getElementById('testContentFile').files[0];
            const resultDiv = document.getElementById('uploadResult');

            if (!imageFile) {
                resultDiv.innerHTML = '<div class="alert error">‚ùå Please select an image!</div>';
                log('‚ùå No image selected', 'error');
                return;
            }

            resultDiv.innerHTML = '<div class="alert info"><div class="loading-spinner"></div> Uploading...</div>';
            log('üì§ Starting upload...', 'info');

            try {
                log('üì∏ Uploading: ' + imageFile.name, 'info');
                const imageResult = await uploadFile(imageFile, 'test-images');
                log('‚úÖ Image uploaded', 'success');

                let contentResult = null;
                if (contentFile) {
                    log('üìÅ Uploading: ' + contentFile.name, 'info');
                    contentResult = await uploadFile(contentFile, 'test-files');
                    log('‚úÖ File uploaded', 'success');
                }

                resultDiv.innerHTML = `
                    <div class="alert success">‚úÖ Upload Successful!</div>
                    <div class="json-viewer">
                        <pre>${JSON.stringify({
                            image: {
                                name: imageFile.name,
                                url: imageResult.url
                            },
                            content: contentResult ? {
                                name: contentFile.name,
                                url: contentResult.url
                            } : null
                        }, null, 2)}</pre>
                    </div>
                    <a href="${imageResult.url}" target="_blank" class="btn">üì∏ View Image</a>
                    ${contentResult ? `<a href="${contentResult.url}" target="_blank" class="btn">üìÅ View File</a>` : ''}
                `;

                stats.uploads++;
                updateStats();
                log('‚úÖ All uploads complete!', 'success');

            } catch (error) {
                resultDiv.innerHTML = `<div class="alert error">‚ùå Error: ${error.message}</div>`;
                log('‚ùå Upload error: ' + error.message, 'error');
            }
        }

        // Upload File Helper
        async function uploadFile(file, category) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = async (e) => {
                    try {
                        const content = btoa(
                            new Uint8Array(e.target.result)
                                .reduce((data, byte) => data + String.fromCharCode(byte), '')
                        );
                        
                        const path = `${category}/mobile/${Date.now()}_${file.name}`;
                        
                        const response = await fetch(`${API_URL}/upload`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                content: content,
                                path: path,
                                message: `Mobile upload: ${file.name}`,
                                username: 'MobileUser'
                            })
                        });

                        const data = await response.json();

                        if (!response.ok || !data.success) {
                            throw new Error(data.error || 'Upload failed');
                        }

                        resolve({
                            url: data.url,
                            path: data.path
                        });

                    } catch (error) {
                        reject(error);
                    }
                };

                reader.onerror = () => reject(new Error('Failed to read file'));
                reader.readAsArrayBuffer(file);
            });
        }

        // Helper: Sleep
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>